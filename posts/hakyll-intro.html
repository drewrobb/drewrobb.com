<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <title>Hakyll Beginnings</title>
  <meta name="description" content />
  <meta name="viewport" content="width=device-width" />
  <link type="image/png" rel="icon" href="../images/favicon.png" />

  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../css/bootstrap.css">

  <link rel="stylesheet" type="text/css" href="../css/styles.css" />

  <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <meta name="viewport" content="width=device-width">
</head>
<body>
  
<div class="navbar navbar-custom">

  <div class="nav navbar-nav navbar-left">
    <a href="../#" style="display: none">
      <img class="avatar" src="../images/drew.jpg">
    </a>
  </div>
  <ul class="nav navbar-nav navbar-right">
    <li><a href="../about.html">about</a></li>
    <li><a href="http://github.com/drewrobb/drewrobb.com">source</a></li>
  </ul>
  <div class="navbar-inner">
    <div class="container">
      <div class="nav">
        <div class="page-heading">
          <a href="../#">
            <h2 style="margin-left: 10px;">Drew Robb</h2>
          </a>
        </div>
      </div>
    </div>
  </div>
  <div class="navbar-background">
  </div>
</div>

<div class="container">
  <div class="col-md-9">
    <h2><a href="../posts/hakyll-intro.html">Hakyll Beginnings</a></h2>
<p class="post-info">
  Posted on January  4, 2013
  
</p>
<p class="tags"><a href="../tags/hakyll.html">hakyll</a>, <a href="../tags/programming.html">programming</a></p>
<h3 id="compilation">Compilation:</h3>
<p>Compiling took 4.8 seconds, and the binary is 38MB!</p>
<pre><code>time ghc --make  site.hs
[1 of 1] Compiling Main             ( site.hs, site.o )
Linking site ...
ghc --make site.hs  4.28s user 0.51s system 99% cpu 4.823 total</code></pre>
<p>It turns out that ghc does static linking to hakyll and its dependencies by default. This is nice in that it creates a more portable binary, but the cost of compile time is too large. Dynamic linking can be enabled in ghc with the dynamic flag. However, cabal installed packages seem to not support this by default:</p>
<pre><code> site.hs:19:8:
     Could not find module `Hakyll'
     Perhaps you haven't installed the &quot;dyn&quot; libraries for package `hakyll-3.4.1.0'?
     Use -v to see a list of the files searched for.</code></pre>
<p>This requires a simple rebuild to support dynamic linking.</p>
<pre><code>cabal install --reinstall --enable-shared hakyll</code></pre>
<p>You might have to also reinstall other cabal dependencies, or just start over as I did.</p>
<p>Finally,</p>
<pre><code>time ghc --make  -dynamic site.hs
[1 of 1] Compiling Main             ( site.hs, site.o )
Linking site ...
ghc --make -dynamic site.hs  1.10s user 0.13s system 98% cpu 1.257 total</code></pre>
<p>It was almost 4 times faster, and the binary is now only 116kB. Success.</p>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> processor = <span class="kw">new</span> StreamingTransform {
  <span class="kw">def</span> <span class="fu">transform</span>(record: Element) = {
    <span class="kw">val</span> id = XQueryUtil.<span class="fu">xquery</span>(record, <span class="st">&quot;IndexCatalogueID&quot;</span>).<span class="fu">get</span>(<span class="dv">0</span>)
    <span class="kw">val</span> placeResults = XQueryUtil.<span class="fu">xquery</span>(record, <span class="st">&quot;//Place&quot;</span>)
    <span class="kw">val</span> places = (<span class="dv">0</span> until placeResults.<span class="fu">size</span>) map placeResults.<span class="fu">get</span>

    <span class="fu">println</span>(id.<span class="fu">getValue</span> + <span class="st">&quot; &quot;</span> + places.<span class="fu">map</span>(_.<span class="fu">getValue</span>).<span class="fu">mkString</span>(<span class="st">&quot;, &quot;</span>))
    <span class="kw">new</span> <span class="fu">Nodes</span>()
  }
}</code></pre></div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = drewrobb';
    var disqus_url = 'http://drewrobb.com' + '/posts/hakyll-intro.html';
    var disqus_title = 'Hakyll Beginnings';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  </div>
  <div class="col-md-3">
    <h3>Recent posts</h3>
    <ul class="recent-posts">
      
        <li><a href="../posts/one-year-running.html">One Year of Running</a></li>
      
        <li><a href="../posts/hakyll-intro.html">Hakyll Beginnings</a></li>
      
        <li><a href="../posts/2012-05-20-road-bike.html">Road Bike Build</a></li>
      
    </ul>
    <h3>Tag</h3>
    <a style="font-size: 75%" href="../tags/cycling.html">cycling</a> <a style="font-size: 75%" href="../tags/hacking.html">hacking</a> <a style="font-size: 75%" href="../tags/hakyll.html">hakyll</a> <a style="font-size: 75%" href="../tags/personal.html">personal</a> <a style="font-size: 75%" href="../tags/programming.html">programming</a> <a style="font-size: 75%" href="../tags/running.html">running</a>
  </div>
</div>



  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-41701342-1', 'drewrobb.com');
    ga('send', 'pageview');
  </script>

</body>
</html>
